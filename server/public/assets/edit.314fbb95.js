import{Q as z}from"./QPage.1a61ec3b.js";import{a as D}from"./axios.bf56c3c5.js";import{Q as F,a as S,b as N,u as M}from"./QCard.7478158e.js";import{a as O,b as Q,Q as v}from"./QItemLabel.29ce2af3.js";import{h as R,l as _,c as P,g as j,Y as b,Z as x,_ as n,f as e,a1 as c,a4 as p,$ as f,a2 as q,a6 as H,F as J,a7 as W,ac as T,a5 as A,r as $,o as X,ad as Y,ae as Z,af as w,ag as L}from"./index.54f58e95.js";import{u as G,a as ee,c as te,Q as B,b as k}from"./QItem.769db7d4.js";const ne=R("div",{class:"q-space"});var E=_({name:"QSpace",setup(){return()=>ne}});const oe={true:"inset",item:"item-inset","item-thumbnail":"item-thumbnail-inset"},I={xs:2,sm:4,md:8,lg:16,xl:24};var y=_({name:"QSeparator",props:{...G,spaced:[Boolean,String],inset:[Boolean,String],vertical:Boolean,color:String,size:String},setup(t){const l=j(),o=ee(t,l.proxy.$q),i=P(()=>t.vertical===!0?"vertical":"horizontal"),d=P(()=>` q-separator--${i.value}`),a=P(()=>t.inset!==!1?`${d.value}-${oe[t.inset]}`:""),s=P(()=>`q-separator${d.value}${a.value}`+(t.color!==void 0?` bg-${t.color}`:"")+(o.value===!0?" q-separator--dark":"")),g=P(()=>{const u={};if(t.size!==void 0&&(u[t.vertical===!0?"width":"height"]=t.size),t.spaced!==!1){const h=t.spaced===!0?`${I.md}px`:t.spaced in I?`${I[t.spaced]}px`:t.spaced,V=t.vertical===!0?["Left","Right"]:["Top","Bottom"];u[`margin${V[0]}`]=u[`margin${V[1]}`]=h}return u});return()=>R("hr",{class:s.value,style:g.value,"aria-orientation":i.value})}});const le={__name:"FormServer",props:["ServerConfig","loadServerConfig"],setup(t){const l=t;function o(){const d=document.location.port;return`${document.location.protocol}//${document.location.hostname}:${d}`}async function i(){var d,a,s,g;console.log("onSaveServer()"),await D.post(o()+"/api/config/",{server:{Address:(a=(d=l.ServerConfig).Address)!=null?a:d.Address="",Endpoint:(g=(s=l.ServerConfig).Endpoint)!=null?g:s.Endpoint="",dns:l.ServerConfig.DNS,ListenPort:l.ServerConfig.ListenPort||0,PersistentKeepalive:l.ServerConfig.PersistentKeepalive||0}}),await l.loadServerConfig()}return(d,a)=>(b(),x(N,{class:"q-ma-md",style:{"max-width":"500px"}},{default:n(()=>[e(O,{class:"bg-transparent text-teal"},{default:n(()=>[e(Q,null,{default:n(()=>[c("Server")]),_:1}),e(E),e(p,{name:"tab2",label:"Reset",dense:"",flat:""}),e(p,{onClick:i,name:"tab3",label:"Save",dense:"",flat:""})]),_:1}),e(F,null,{default:n(()=>[e(v,null,{default:n(()=>[c("SELF")]),_:1}),e(S,{"bottom-slots":"",dense:"",filled:"",modelValue:t.ServerConfig.Address,"onUpdate:modelValue":a[0]||(a[0]=s=>t.ServerConfig.Address=s),class:"q-mt-sm",label:"IP Address",placeholder:"192.168.0.1/24",hint:"This server's address in CIDR (xxx.xxx.xxx.xxx/xx) format"},{before:n(()=>[e(f,{name:"home"})]),_:1},8,["modelValue"]),e(y,{class:"q-mt-md"}),e(v,{class:"q-mt-md"},{default:n(()=>[c("CONNECTION")]),_:1}),e(S,{"bottom-slots":"",dense:"",filled:"",modelValue:t.ServerConfig.Endpoint,"onUpdate:modelValue":a[1]||(a[1]=s=>t.ServerConfig.Endpoint=s),class:"q-mt-sm",label:"Endpoint",placeholder:"host.your.domain",hint:"Address clients connect to"},{before:n(()=>[e(f,{name:"vpn_lock"})]),_:1},8,["modelValue"]),e(S,{"bottom-slots":"",dense:"",filled:"",modelValue:t.ServerConfig.ListenPort,"onUpdate:modelValue":a[2]||(a[2]=s=>t.ServerConfig.ListenPort=s),class:"q-mt-sm",label:"ListenPort",placeholder:"51820",hint:"Port clients connect to"},{before:n(()=>[e(f,{name:"numbers"})]),_:1},8,["modelValue"]),e(y,{class:"q-mt-md"}),e(v,{class:"q-mt-md"},{default:n(()=>[c("AUTHENTICATION")]),_:1}),e(S,{"bottom-slots":"",modelValue:t.ServerConfig.Address,"onUpdate:modelValue":a[3]||(a[3]=s=>t.ServerConfig.Address=s),class:"q-mt-sm",label:"PrivateKey",hint:"Private key (DO NOT SHARE)",dense:"",filled:""},{before:n(()=>[e(f,{name:"key"})]),_:1},8,["modelValue"]),e(S,{"bottom-slots":"",modelValue:t.ServerConfig.Address,"onUpdate:modelValue":a[4]||(a[4]=s=>t.ServerConfig.Address=s),class:"q-mt-sm",label:"PublicKey",hint:"Public key (ok to share)",dense:"",filled:""},{before:n(()=>[e(f,{name:"public"})]),_:1},8,["modelValue"]),e(y,{class:"q-mt-md"}),e(v,{class:"q-mt-md"},{default:n(()=>[c("OPTIONAL")]),_:1}),e(S,{"bottom-slots":"",dense:"",filled:"",modelValue:t.ServerConfig.PersistentKeepalive,"onUpdate:modelValue":a[5]||(a[5]=s=>t.ServerConfig.PersistentKeepalive=s),class:"q-mt-sm",label:"PersistentKeepalive",placeholder:"30",hint:"Heartbeat(sec)"},{before:n(()=>[e(f,{name:"favorite"})]),_:1},8,["modelValue"]),e(S,{"bottom-slots":"",dense:"",filled:"",modelValue:t.ServerConfig.DNS,"onUpdate:modelValue":a[6]||(a[6]=s=>t.ServerConfig.DNS=s),class:"q-mt-sm",label:"DNS",hint:"DNS overwrite after connection"},{before:n(()=>[e(f,{name:"menu_book"})]),_:1},8,["modelValue"])]),_:1})]),_:1}))}},ae={__name:"FormPeer",props:["PeerConfig","onSavePeer"],setup(t){return(l,o)=>(b(),x(N,{class:"q-ma-md",style:{"max-width":"500px"}},{default:n(()=>[e(O,{class:"bg-transparent text-teal"},{default:n(()=>[e(Q,null,{default:n(()=>[c("Peer")]),_:1}),e(E),e(p,{icon:"refresh",label:"Reset",flat:"",dense:""}),e(p,{onClick:t.onSavePeer,icon:"save",label:"Update",flat:"",dense:""},null,8,["onClick"])]),_:1}),e(F,null,{default:n(()=>[e(v,null,{default:n(()=>[c("SELF")]),_:1}),e(S,{"bottom-slots":"",dense:"",filled:"",modelValue:t.PeerConfig.id,"onUpdate:modelValue":o[0]||(o[0]=i=>t.PeerConfig.id=i),class:"q-mt-sm",label:"ID",placeholder:t.PeerConfig.OrigId,hint:"An id to identify this peer."},{before:n(()=>[e(f,{name:"home"})]),_:1},8,["modelValue","placeholder"]),e(S,{"bottom-slots":"",dense:"",filled:"",modelValue:t.PeerConfig.Address,"onUpdate:modelValue":o[1]||(o[1]=i=>t.PeerConfig.Address=i),class:"q-mt-sm",label:"IP Address",placeholder:"192.168.0.1/24",hint:"This server's address in CIDR (xxx.xxx.xxx.xxx/xx) format"},{before:n(()=>[e(f,{name:"home"})]),_:1},8,["modelValue"]),e(v,{class:"q-mt-md"},{default:n(()=>[c("OPTIONAL")]),_:1}),e(S,{"bottom-slots":"",dense:"",filled:"",modelValue:t.PeerConfig.DNS,"onUpdate:modelValue":o[2]||(o[2]=i=>t.PeerConfig.DNS=i),class:"q-mt-sm",label:"DNS",placeholder:"192.168.0.1/24",hint:"An id to identify this peer."},{before:n(()=>[e(f,{name:"home"})]),_:1},8,["modelValue"])]),_:1})]),_:1}))}},se={__name:"FormMain",props:["config","onAddPeer","onSelectPeer","onSelectServer","onDeletePeer"],setup(t){const l=t,o=P(()=>Object.keys(l.config.peers).map(g=>({id:g,Address:l.config.peers[g].Address}))),i=P(()=>l.config.server);function d(){const s=document.location.port;return`${document.location.protocol}//${document.location.hostname}:${s}`}async function a(){console.log(JSON.stringify(l.config)),await D.post(d()+"/api/config/",l.config)}return(s,g)=>(b(),x(N,null,{default:n(()=>[e(O,{class:"bg-transparent text-teal"},{default:n(()=>[e(Q,null,{default:n(()=>[c("Config")]),_:1}),e(E),e(p,{onClick:a,icon:"save",dense:"",round:"",flat:""}),e(p,{onClick:t.onAddPeer,icon:"add",dense:"",round:"",flat:""},null,8,["onClick"])]),_:1}),e(te,null,{default:n(()=>[e(B,{onClick:t.onSelectServer,tag:"label"},{default:n(()=>[e(k,null,{default:n(()=>[e(v,null,{default:n(()=>[c("Server")]),_:1}),e(v,{caption:""},{default:n(()=>[c(q(i.value.Address),1)]),_:1})]),_:1}),e(k,{side:""},{default:n(()=>[e(f,{name:"home"})]),_:1})]),_:1},8,["onClick"]),e(v,{header:""},{default:n(()=>[c("PEERS (5)")]),_:1}),(b(!0),H(J,null,W(o.value,u=>(b(),x(B,{onClick:T(h=>t.onSelectPeer(u.id),["prevent"]),tag:"label"},{default:n(()=>[e(k,null,{default:n(()=>[e(v,null,{default:n(()=>[c(q(u.id),1)]),_:2},1024),e(v,{caption:""},{default:n(()=>[c(q(u.Address),1)]),_:2},1024)]),_:2},1024),e(k,{side:""},{default:n(()=>[A("div",null,[e(p,{onClick:T(h=>t.onDeletePeer(u.id),["stop"]),dense:"",flat:"",round:"",icon:"delete"},null,8,["onClick"])])]),_:2},1024)]),_:2},1032,["onClick"]))),256))]),_:1})]),_:1}))}},re={class:"row"},ie={class:"col-8"},de={class:"col-4"},ce={class:"q-my-md q-mr-md"},Ce=Object.assign({name:"IndexPage"},{__name:"edit",setup(t){M();const l=$({server:{},peers:[]}),o=$({}),i=$({config:l,onAddPeer:V,onSelectPeer:s,onSelectServer:a,onDeletePeer:g});var d=null;X(async()=>{await U()});function a(){o.value={ServerConfig:l.value.server,loadServerConfig:U},d=le}function s(r){console.log(`[debug] onSelectPeer: ${r}`);const m=JSON.stringify(l.value.peers[r]),C=JSON.parse(m);C.id=r,C.OrigId=r,o.value={PeerConfig:C,onSavePeer:u},d=ae}function g(r){"PeerConfig"in o.value&&"OrigId"in o.value.PeerConfig&&a(),delete l.value.peers[r]}function u(){const r=l.value.peers;o.value.PeerConfig.id!==o.value.PeerConfig.OrigId&&(r[o.value.PeerConfig.id]=r[o.value.PeerConfig.OrigId],delete r[o.value.PeerConfig.OrigId],o.value.PeerConfig.OrigId=o.value.PeerConfig.id),console.log(o.value.PeerConfig);const m=o.value.PeerConfig.id;r[m].Address=o.value.PeerConfig.Address,console.log(r[m]),console.log(r)}function h(){const r=document.location.port;return`${document.location.protocol}//${document.location.hostname}:${r}`}function V(){console.log(l.peers);const r=K();l.value.peers[r]={Address:""},s(r)}function K(){const r="peer";for(var m=0,C=null;C=r+m,!!Object.keys(l.value.peers).includes(C);)m++;return C}async function U(){const r=await D.get(h()+"/api/config/"),m=r.data;"server"in m&&(l.value=r.data,a()),console.log(m)}return(r,m)=>(b(),x(z,{class:""},{default:n(()=>[A("div",re,[A("div",ie,[(b(),x(Y(Z(d)),w(L(o.value)),null,16))]),A("div",de,[A("div",ce,[e(se,w(L(i.value)),null,16)])])])]),_:1}))}});export{Ce as default};
